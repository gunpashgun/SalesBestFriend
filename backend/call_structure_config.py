
"""
Call Structure Configuration for Trial Class Sales Calls

Defines the expected flow of a trial class sales call with:
- Stages
- Timing per stage
- Checklist items per stage

This structure is used for:
1. Real-time progress tracking
2. LLM semantic matching (conversation â†’ checklist items)
3. Time-based stage detection
4. Settings UI (editable by user)

NOTE: This file is auto-generated from 'New Script 2025 - NEW SCRIPT 2025.csv'.
      Do not edit this file directly.
"""

from typing import List, Dict, TypedDict, Any


class ChecklistItem(TypedDict):
    """Single checklist item within a stage"""
    id: str
    type: str  # "discuss" or "say"
    content: str  # What to ask/discuss or what to say/explain
    extended_description: str # Detailed description for the LLM


class CallStage(TypedDict):
    """Single stage in the call structure"""
    id: str
    name: str
    startOffsetSeconds: int  # When this stage should start (from call start)
    durationSeconds: int  # How long this stage should last
    items: List[ChecklistItem]


DEFAULT_CALL_STRUCTURE: List[CallStage] = [
    {
        "id": "stage_greeting____1__2_1__2_1__2_1__2_1__2",
        "name": "Greetings & Get Ready Before Trial Class",
        "startOffsetSeconds": 0,
        "durationSeconds": 180,
        "items": [
            {
                "id": "item_memulai_dengan__enyum_dan_good_appearance_1",
                "type": "say",
                "content": "Memulai dengan senyum dan good appearance\\nGuidelines Dress Code TCM: Guidlines Dress Codes for TCMs",
                "extended_description": "The core objective of this item is to ensure the tutor starts the trial class with a positive and professional demeanor. The AI should look for keywords related to greetings, appearance, and readiness, such as 'welcome,' 'good morning,' 'smile,' 'neat,' 'professional,' and 'ready.' A statement like 'Hello, welcome to our class! I hope you're ready for a fun session' would satisfy this item. The AI should avoid flagging simple acknowledgments like 'okay' or 'yes' as completion of this item."
            },
            {
                "id": "item_opening_with_1__2___1__2_nama_anak_dan_orang_tua__e_uai_data_amo_2",
                "type": "say",
                "content": "Opening with English & Konfirmasi nama anak dan orang tua sesuai data AMO\\nNotes: Melakukan opening dalam bahasa Inggris sejak klien on video dan audio zoom, dengan tujuan menegaskan citra Algonova sebagai sekolah berstandar internasional.\\n\\nExample: \"Hello Parent (Mom/Dad) and Adik (prefer langsung sebut Nama Anak). Welcome to Algonova, International IT School\"",
                "extended_description": "The main goal is to confirm the child's and parent's names and establish an international school's image. The AI should detect phrases like 'confirm name,' 'parent's name,' 'child's name,' 'based on our data,' and greetings in English. An example of a suitable statement is, 'Good morning! I'm here with [Parent's Name] and [Child's Name], is that correct?' The AI should not mark this as complete if only a generic greeting is given without name confirmation."
            },
            {
                "id": "item_greeting_3",
                "type": "say",
                "content": "Greetings\\nNotes:\\nSetelah memperkenalkan diri, bisa tambahkan pertanyaan singkat untuk mencaikan suasa dan membangun bonding dengan anak serta orang tua sejak awal sesi. Sesuai dengan usia client, dan pastikan TCM memberikan first impression yang menyenangkan.\\n\\nExample:\\n5-7yo\\n- Hallo (nama anak), udah siap hari ini belajar dan bermain sama Miss?\\n- Hallo (nama anak), udah makan siang/malam hari ini? udah siap yaa buat belajar dan bermain sama Miss?\\n\\n8-12yo\\n\"Hallo (nama anak), gimana nih kabar kamu hari ini? udah siap yaa siang ini belajar dan seru seruan sama Miss?\"\\n\\n13-17yo\\n\"Hallo (nama anak), udah tau belum nih kita hari ini mau ngapain? oke udah siap ya belajar Coding/Math/Design hari ini sama Miss.",
                "extended_description": "This item aims to build rapport with the child and parent through a warm and age-appropriate greeting. The AI should look for keywords such as 'how are you,' 'how was your day,' 'ready to play,' 'excited,' and other friendly questions. For a young child, a good example is, 'Are you excited to learn with me today?' A simple 'hello' without a follow-up question would not be sufficient to complete this item."
            },
            {
                "id": "item_confirm_client_readine___anak_dan_pendampingan_orang_tua_4",
                "type": "say",
                "content": "Confirm client readiness (anak dan pendampingan orang tua)\\nNotes: TCM wajib memastikan anak dan orang tua sudah dalam posisi siap untuk trial class, duduk dan masuk dalam satu frame. Contoh: mempersilakan orang tua untuk duduk, mempersiapkan kursi, menghapus background zoom jika menghalangi orang tua/anak untuk terlihat di video, dan menunggu orang tua untuk bersiap-siap misal menggunakan hijab untuk perempuan.\\n\\nExample:\\n\" Untuk sesi trial class akan berlangsung kurang lebih 60 menit kedepan, dan wajib untuk didampingi, apakah bisa mama/papa mendampingi selama sesi trial class berlangsung?\"\\n\\n\"Selamat malam (nama anak) dan mama/papa, saya Mega dari Algonova, untuk sesinya nanti kurang lebih 60 menit mama/papa dan wajib didampingi, bagaimana apakah bisa? berkenan untuk persiapan terlebih dulu jika mama/papa mau mengambil kursi biar bisa bersebelahan dengan (nama anak) dan masuk dalam satu frame ya mama/papa\"\\n\\n\"Selamat malam (nama anak), saat ini dirumah kamu ditemenin siapa? boleh dibantu panggil mama/papa untuk mendampingi. Selamat malam mama/papa, saya (nama TCM) dari Algonova, untuk sesi trial class saat ini wajib didampingi apakah mama/papa bisa untuk saat ini?\"",
                "extended_description": "The objective is to ensure that both the child and parent are ready and properly set up for the trial class. The AI should identify phrases like 'are you ready,' 'is a parent with you,' 'can you see me clearly,' 'is the audio working,' and 'in the same frame.' A good example is, 'Before we begin, I just want to make sure you can both see and hear me well.' This item is not complete if the tutor starts the lesson without confirming the setup."
            },
            {
                "id": "item_handling_technical_i_ue_5",
                "type": "say",
                "content": "Handling technical issues\\nNotes:\\n- TCM wajib aware sejak awal terkait kendala klien agar bisa segera terselesaikan, trial class berlangsung secara efektif dan proses pergantian dari klien ori dan klien OB lebih cepat. Contoh: kendala audio, video, internet, device, dan zoom web.\\n- Pengecekan internet dan device dilakukan jika indekasi kendala muncul agar waktu TC tetap efektif.\\n\\nExample:\\n- Konfirmasi awal sebelum trial class dimulai (jika audio video belum aktif)\\n\"Selamat malam parents, boleh dibantu untuk menyalakan audio dan videonya terlebih dulu sebelum kelas dimulai, bisa klik gambar mic dan video yang ada di pojok kiri bawah\"\\n - Anak menggunakan headset\\n\"Selamat malam (nama anak), suara Miss saat ini terdengar jelas? untuk saat ini apakah ada kendala untuk audio dari laptop jika tidak menggunakan headset? baik, untuk sesi trial class, (Nama anak) tidak perlu menggunakan headset dulu yaa, jadi nanti biar suara Miss bisa terdengar juga sama mama/papa, karena nanti akan ada sesi diskusi juga dengan orang tua\" (opsional jika anak/orang tua yang menggunakan headset)\\n- Kendala video\\n\"Selamat malam (Nama anak/ orang tua yang sedang berkomunikasi) saat ini untuk videonya ada kendala ya? sehingga tidak bisa terbuka, untuk sementara saat ini Miss bantu untuk mama/papa menggunakan dual device dari handphone yaa, jadi silakan bergabung juga menggunakan zoom di HP agar nanti videonya bisa menggunakan HP.\\n- Kendala Audio\\n\"Selamat malam (Nama anak/ orang tua yang sedang berkomunikasi) saat ini untuk audionya ada kendala ya? sehingga Miss saat ini masih belum bisa mendengar suara, untuk sementara saat ini Miss bantu untuk mama/papa menggunakan dual device dari handphone yaa, jadi silakan bergabung juga menggunakan zoom di HP agar nanti audionya bisa menggunakan HP.\" (Bisa juga dikirimkan melalui pesan teks zoom dan AMO).",
                "extended_description": "The goal is to proactively identify and resolve any technical difficulties at the beginning of the class. The AI should look for keywords like 'technical issues,' 'audio problems,' 'video not working,' 'internet connection,' and 'troubleshoot.' A suitable statement would be, 'I see your video is off. Is there a problem with the camera?' The AI should avoid marking this as complete if the tutor only asks a general question like 'is everything okay?'"
            },
            {
                "id": "item_tc_proce___tage_6",
                "type": "discuss",
                "content": "TC process stages\\nNotes: Sampaikan tahapan TC secara clear, hindari kalimat \"jika (nama anak) dan mama/papa cocok\", karena kita akan memastikan klien cocok dengan pembelajaran di sesi trial class.\\n\\nExample:\\n\"Selanjutnya Miss/Mr sampaikan untuk agenda kita kedepan yaa, hari ini kita akan ada 4 sesi:\\n1. Pertama, adalah sesi observasi, Miss mau kenalan dulu sama (nama anak), jadi Miss bisa tahu untuk minat bakat (nama anak) seperti apa. Selain itu, Miss mau ngobrol juga ya sama mama/papa, biar Miss tahu untuk tujuan dan harapannya kedepan untuk (nama anak) bagaimana.\\n2. Sesi selanjutnya adalan main session yaa mama/papa dan (nama anak), Miss akan mengajak (nama anak) untuk praktik, jadi kita akan mencoba langsung pembelajaran yang ada di Algonova sesuai dengan yang Miss rekomendasikan berdasarkan sesi perkenalan.\\n3. Setelah itu Miss akan memperkenalkan Algonova secara lengkap beserta dengan kurikulum pembelajarannya.\\n4. Sesi teakhir adalah administrasi ya mama/papa, Miss akan bantu untuk proses pendaftaran dan pembayaran kelas lanjutannya selama zoom meeting berlangsung.\\nAda yang mau dinyakan dulu mama/papa sebelum miss lanjutkan untuk sesinya?\"",
                "extended_description": "This item's objective is to clearly outline the agenda for the trial class. The AI should detect keywords like 'agenda,' 'plan for today,' 'what we will do,' 'first,' 'second,' and 'finally.' An example statement is, 'Today, we will start with a short introduction, then we'll do a fun activity, and at the end, we'll have a brief chat.' This item is not complete if the tutor only mentions the next immediate activity."
            }
        ]
    },
    {
        "id": "stage_profiling",
        "name": "Profiling",
        "startOffsetSeconds": 180,
        "durationSeconds": 420,
        "items": [
            {
                "id": "item_konfirma_i_u_ia_dan_tingkat__ekolah_anak__1__2_data_di_amo_7",
                "type": "discuss",
                "content": "Konfirmasi usia dan tingkat sekolah anak (Berdasarkan data di AMO)\\nNotes: TCM wajib sudah cek data klien di AMO, mengkonfirmasikan ke klien dan mengembangkan menjadi pertanyaan yang lebih detail untuk mengetahui data pasti klien baik dari usia maupun tingkat kelas. Komunikasi juga dilakukan secara santai seperti mengobrol.\\n\\nExample:\\n\"Miss/Mr kenalan dulu yaa sama (nama anak), sudah siap belum? baik, Miss/Mr konfirmasi terlebih dulu sesuai data pendaftaran yaa mama/papa. Benar saat ini (nama anak) usianya 8 tahun ya? oke, ulang tahunnya bulan apa nih? wahh 8 tahun sudah mau 9 tahun yaa ternyata 1 bulan lagi, berarti sekolahnya sudah kelas 3 atau kelas berapa?\\n\\n\"Miss/Mr mau ngobrol dulu yaa sama (nama anak), Miss/Mr izin konfirmasi terlebih dulu sesuai data pendaftaran yaa mama/papa. (nama anak) saat ini usianya betul sudah 12 tahun ya? 12 tahunnya lebih atau kurang nih? ulang tahunnya bulan apa? oke jadi 12 tahunnya masih 3 bulan lagi yaa, kalo sekolahnya sekarang kelas berapa? sekolah dimana?\"\\n\\n\"Miss/Mr {nama TCM} konfirmasi terlebih dahulu dari data pendaftaran  yang masuk ke sistem ya Moma/papa.\" (dilanjutkan dengan konfirmasi data dan memastikan lebih detail)",
                "extended_description": "The main goal is to verify the child's age and grade level based on the provided data. The AI should look for phrases like 'confirm your age,' 'what grade are you in,' 'our records show,' and 'is that correct.' A good example is, 'Our information says you are 8 years old and in the 3rd grade, is that right?' This is not complete if the tutor only asks for the child's name."
            },
            {
                "id": "item_konfirma_i__iapa_yang_mendaftarkan___umber_informa_i__dan_ketertarikan_tentang_1__2__1__2_data_di_amo_8",
                "type": "discuss",
                "content": "Konfirmasi siapa yang mendaftarkan, sumber informasi, dan ketertarikan tentang Algonova (Berdasarkan data di AMO)\\nNotes: TCM wajib sudah cek data klien di AMO, mengkonfirmasikan ke klien terkait siapa yang mendaftar dan ketertarikan dengan Algonova sesuai dengan iklan yang dilihat saat mendaftar trial class.\\n\\nExample:\\n\"Keren banget nih mam, (nama anak) sudah siap untuk belajar \"Math\"? Kalo untuk yang mendaftarkan (nama anak) di trial class hari ini betul dengan mama/papa sendiri ya? Miss lihat mama mendaftar melalui iklan tentang \"Math\" di facebook betul yaa mam? apa nih mam yang membuat mama tertarik dari iklan Math Algonova untuk (nama anak)?\"\\n\\n\"Wahh mam ternyata (nama anak) belum tahu nih hari ini kita mau ngapain, ini Miss cek di data sepertinya nomor papa yaa mam? untuk yang mendaftarkan di sesi trial class ini betul dengan papa dan mama yang mendampingi atau seperti apa nih mam?, papa udah cerita belum nih mam kenapa daftarin (nama anak) di trial class? Miss lihat papa daftar melalui iklan tentang \"drawing\" di intagram, kira-kira apa nih yang membuat mama/papa tertarik dari iklan itu untuk (nama anak)?",
                "extended_description": "The objective is to understand who registered for the class and what prompted them to do so. The AI should detect keywords such as 'who registered,' 'how did you hear about us,' 'what interested you,' and 'saw an ad.' An example statement is, 'I see you found us through a Facebook ad. What about it caught your interest?' A simple 'how are you today?' would not suffice."
            },
            {
                "id": "item_konfirma_i_tujuan_mendaftar___preferen_i_belajar__1__2_data_di_amo_9",
                "type": "discuss",
                "content": "Konfirmasi tujuan mendaftar & preferensi belajar (Berdasarkan data di AMO)\\nNotes: TCM wajib sudah cek data klien di AMO, mengkonfirmasikan ke klien terkait tujuan pendidikan yang ada di AMO bagian \"Quiz Answer\" dan \"Profiling Result (jika ada)\" kemudian mengembangkan pertanyaan lebih spesifik dan detail preferensi belajar.\\n\\nExample:\\n\"Jadi tertarik dengan iklan Math Algonova karena (nama anak) ada kendala ya mam di pembelajaran sekolah, sesuai juga ya mam dari tujan mama/papa mendaftar untuk \"meningkatkan prestasi di sekolah\", sebelumnya (nama anak) sudah pernah ikut les atau pembelajaran online belum ya mam? kalo dari mama/papa sendiri nih, harapan dan tujuannya kedepan untuk (nama anak) jika ikut kelas di Algonova seperti apa target mama/papa? Kalo  dari mama/papa saat ini memang sedang mencari les Math ya untuk (nama anak)?\"\\n\\n\"Ohh jadi karena (nama anak) hobi gambar yaa mama/papa, dan mau dicoba dulu setelah lihat iklannya menarik. Nah kalo dari tujuan mama/papa ini Miss cek itu untuk \"memberikan pendidikan masa depan\", pendidikan masa depan yang seperti apa nih yang mama/papa harapkan dari Algonova untuk (nama anak)? ada tujuan atau target kedepan untuk (nama anak) nantinya selama belajar di Algonova?. (nama anak) sebelumnya sudah pernah ikut kelas online? kalo dari mama/papa saat ini memang masih mencari tempat les drawing kah untuk (nama anak)?\"",
                "extended_description": "This item aims to understand the parent's goals and the child's learning preferences. The AI should look for phrases like 'learning goals,' 'what do you want to achieve,' 'preferred learning style,' and 'any specific areas to focus on.' A good question would be, 'What are your main goals for your child's learning with us?' This is not complete if the tutor only asks about the child's favorite subject."
            },
            {
                "id": "item_menggali_kemampuan_komputer_dan_pengetahuan_coding_de_ign_math_10",
                "type": "discuss",
                "content": "Menggali kemampuan komputer dan pengetahuan coding/design/math\\nNotes: TCM wajib menggali kemampuan komputer anak, pengetahuan basic tentang coding/design/ kemampuan Math. (Wajib menggali kemampuan komputer dan Math untuk meningkatkan potensi payment bundling berdasarkan kebutuhan anak)\\n\\nExample:\\nDesign/Coding\\n\"Di sekolah sudah belajar komputer belum? Udah belajar apa aja? Seru gak belajar komputer?\"\\n\"Kalo di rumah sudah pernah diajari sama mama/papa belajar menggunakan laptop? kalo ngetik ngetik dan menggunakan mouse sudah bisa ya?\"\\n\"(nama anak) sudah pernah denger atau tau tentang coding?\"\\n\"Kamu pernah gambar di tablet atau komputer?\"\\n\\nMath\\n\"Kalo di sekolah kamu paling suka pelajaran apa?, kalo Math gimana kamu suka gak? atau ada kesulitan?\"\\n\"Kenapa nih kamu kurang suka Math?\"\\n\"Kamu merasa Math paling sulit di bagian apa?\"",
                "extended_description": "The goal is to assess the child's current computer skills and knowledge of the subject. The AI should identify keywords like 'computer skills,' 'typing,' 'using a mouse,' 'coding experience,' 'math level,' and 'design tools.' An example is, 'Have you ever used any coding or design software before?' The item is not complete if the tutor only asks a generic question about school."
            },
            {
                "id": "item_menggali_hobi__aktivita__harian_dan_cita_cita_anak_11",
                "type": "discuss",
                "content": "Menggali hobi, aktivitas harian dan cita-cita anak\\nNotes: TCM wajib mengetahui dan menggali hobi, aktivitas, dan cita-cita anak untuk mengetahui potensi belajar secara online dan menghubungkan dengan course yang akan direkomendasikan.\\n\\nExample:\\n\"Selain sekolah, kamu ada ikut les atau ekskul sepulang sekolah?\"\\n\"Kalo ada waktu senggang biasanya kamu ngapain aja nih sukanya?\"\\n\"Tadi mama/papa sampaikan kamu suka gambar ya? biasanya kamu suka gambar apa? gambarnya pakai kertas atau udah di tablet/laptop nih? boleh gak Miss ditunjukin contoh gambaran kamu?\"\\n\"Kalo nonton, main game gitu kamu suka gak? game apa aja yang biasa kamu mainkan? main gamenya pakai apa?\"\\n\\n\"Kamu kan punya bakat dan hobi gambar/design tuh, kira-kira kamu udah kepikiran belum nanti cita-citanya mau jadi apa?\"\\n\"Wahhh banyak banget yaa hobi kamu ternyata, Miss jadi penasaran, kira-kira kamu kalo sudah besar cita-citanya jadi apa nih?\"",
                "extended_description": "The objective is to learn about the child's interests, daily activities, and aspirations to personalize the learning experience. The AI should look for phrases like 'hobbies,' 'what do you do for fun,' 'favorite activities,' 'dream job,' and 'when you grow up.' A good question is, 'What are some of your favorite things to do after school?' This is not complete if the tutor only asks about their favorite color."
            },
            {
                "id": "item_real_1__2_1__2_n_1__2_perbedaan_1__2_dari__ekolah_12",
                "type": "discuss",
                "content": "Real Point Math\\n\\nMenonjolkan perbedaan Algonova dari sekolah\\nNotes: Kaitkan antara kebutuhan klien atau problem dengan menjelaskan perbedaan Math Algo dan sekolah, tidak perlu menjelaskan terlalui detail dan panjang, karena sebelum praktik akan ada penjelasan road map course. Jelaskan sesuai respon dari client.\\n\\nExample:\\n\"Baik mam, ternyata (nama anak) ada kesulitan ya untuk mengikuti pembelajaran di sekolah, kemungkinan karena metode belajar yang ada di sekolah biasanya ditekankan dengan hafalan dan driling soal, suasana kelas yang sangat ramai dan waktu yang terbatas juga menjadi faktor anak sulit memahami, apalagi anak tidak bisa mengakses pembelajaran itu berulang kali, sedangkan di Algonova, kami menggunakan metode pemahaman konsep sehingga soal dan teori Math dalam bentuk apapun yang sama dengan di sekolah bisa mudah dipahami anak, selain itu kami juga berbasis IT sehingga kelas lebih menyenangkan dan pembelajaran bisa diakses di rumah di luar jadwal les, hal ini bisa meningkatkan hasil Math (nama anak) di sekolah. \"",
                "extended_description": "This item aims to highlight the unique advantages of Algonova's math program compared to traditional schooling. The AI should detect keywords like 'different from school,' 'our method,' 'conceptual understanding,' 'fun and interactive,' and 'learn at your own pace.' An example is, 'Unlike in school where you memorize formulas, here we focus on understanding the concepts behind them.' The item is not complete if the tutor only talks about the price."
            },
            {
                "id": "item_real_1__2__1__2___1__2__n_1__2_pemahaman__ingkat_terkait_dengan_coding_de_gin_dan_najak_anak_membayangkan_mereka_menjadi__eorang_game_dev_animator_cilik_dan_tanyakan_apa_yang_ingin_mereka_buat_13",
                "type": "discuss",
                "content": "Real Point (Coding & Design)\\n\\nBerikan pemahaman singkat terkait dengan coding/desgin dan\\najak anak membayangkan mereka menjadi seorang game dev/animator cilik dan tanyakan apa yang ingin mereka buat\\nNotes: Point ini lebih menekankan untuk TCM menjelaskan singkat tentang coding atau design dan mengajak anak berimaginasi ketika anak menjadi seseorang dengan profesi yang berkaitan dengan IT, serta menanyakan apa yang akan mereka lakukan atau mereka buat.\\n- Point ini dilakukan agar tujuan anak jelas, dan anak tidak bingung ketika ditanya mau membuat apa karena sudah diafirmasi terlebih dulu terkait pengetahuan singkat coding dan design, dan TCM sudah memberikan penjelasan \"jika anak sudah bisa, jika anak jadi orang yang berprofesi di bidang IT\\n\\nExample:\\n\\n\"Hari ini Miss/Mr akan mengajak kamu untuk belajar coding, nah apa itu koding sederhananya kita akan belajar bahasa komputer untuk membuat sesuatu seperti game atau animasi\"\\n\"Hari ini Miss/Mr akan mengajak kamu untuk belajar design, nah kamu akan mencoba gimana menggambar pakai laptop, jadi nanti gambarnya bisa dibuat bergerak juga jadi animasi\"\\n\\nNote: Selanjutnya ajak anak berimaginasi dan tanyakan apa yang mau mereka buat.\\n\\n5-7yo\\n\"Miss/Mr mau ngajak (nama anak) buat bayangin nih, kalo (nama anak) udah pinter design/pinter coding, terus jadi orang yang bisa buat game sendiri, gambar kartun, kira-kira kamu mau buat game/karakter apa?\"\\n\\n5-13yo\\n\"Selanjutnya, coba kamu bayangin nih udah bisa coding/bisa design, jadi orang yang bisa buat game/ animasi, kira-kira apa yang mau kamu buat?\"\\n\\n14-17yo\\n\"Nahh coba deh kamu bayangin kamu udah pinter coding / pinter ngedesign, bisa jadi programer, game developer, atau animator, kamu paling pengen bikin apa?\"",
                "extended_description": "The goal is to spark the child's interest in coding or design by having them imagine what they could create. The AI should look for phrases like 'imagine you could build,' 'what game would you create,' 'design your own character,' and 'become a game developer.' A good example is, 'If you could create any game you wanted, what would it be about?' A generic question about their favorite game would not be enough."
            },
            {
                "id": "item_menyimpulkan_ha_il_profiling_dan_merekomenda_ikan_cour_e_14",
                "type": "say",
                "content": "Menyimpulkan hasil profiling dan merekomendasikan course\\nNotes: TCM wajib menyimpulkan secara lengkap dari hasil profiling anak dan orang tua serta memberikan rekomendasi yang sesuai course berdasarkan usia, kemampuan komputer/math dan kebutuhan klien.\\n\\nExample:\\n\"Baik terima kasih mama/papa dan (nama anak), sebelum ke sesi berikutnya, Miss simpulkan dulu ya informasi yang Miss dapatkan, jadi saat ini (nama anak) usianya bulan depan sudah 9 tahun dan kelas 3 SD, mama/papa mendaftarkan (nama anak) tujuannya adalah untuk meningkatkan kemampuan Math sehingga nilai sekolahnya meningkat, betul tadi yaa Miss saat ngobrol sama (nama anak) ternyata (nama anak) ada kesulitan Math di pembagian dan perkalian, selain itu ternyata (nama anak) hobi main game juga, dan cita-citanya mau jadi guru. Nah untuk merealisasikan goals mama dan (nama anak) tadi, Miss rekomendasikan untuk (nama anak) masuk di kelas Math Master terlebih dulu yaa, sebelum itu ada yang ditanyakan mam?\"\\n\\n\"Baik terima kasih mama/papa dan (nama anak), sebelum ke sesi berikutnya, Miss simpulkan dulu ya informasi yang Miss dapatkan, jadi saat ini (nama anak) 11 tahun, sudah mau 12 tahun dan sudah kelas 2 SMP yaa, mama/papa mendaftarkan (nama anak) tujuannya adalah untuk mepersiapkan masa depan (nama anak) dengan mengembangkan bakat dan minat (nama anak) di bidang design dan IT, saat ngobrol sama (nama anak) ternyata benar yaa (nama anak) hobi menggambar, menonton, dan bermain game, cita-citanya mau jadi content creator. Nah untuk merealisasikan goals mama dan (nama anak) tadi, Miss rekomendasikan untuk (nama anak) masuk di kelas Graphic Design Senior sesuai dengan usia dan hobi (nama anak), sebelum Miss lanjutkan sesinya ada yang mau ditanyakan dulu dari (nama anak) dan mama/papa?\"",
                "extended_description": "The objective is to summarize the information gathered during the profiling stage and recommend a suitable course. The AI should detect keywords like 'based on what you've told me,' 'I recommend,' 'the best course for you,' and 'to summarize.' An example is, 'Based on your interest in drawing and video games, I recommend our Graphic Design course.' This is not complete if the tutor recommends a course without summarizing the reasons."
            }
        ]
    },
    {
        "id": "stage_practical",
        "name": "Practical",
        "startOffsetSeconds": 600,
        "durationSeconds": 1200,
        "items": [
            {
                "id": "item_before_1__2__n_1__2_road_map_pembelajaran__ejala__jela_15",
                "type": "say",
                "content": "Before Practical:\\n\\nMenunjukan road map pembelajaran sejalas jelas\\nNotes: (tidak harus berurutan)\\n- TCM wajib menanamkan keyakinan ke orang tua/anak bahwa kelas Algonova bermanfaat dan menyenangkan untuk anak, bisa menyalurkan hobi + skill. (bisa menggunakan contoh karya anak, silabus, IL)\\n- Menekankan bahwa Algonova memiliki roadmap pembelajaran yang jelas. (menggunakan LP bagian couse)\\n- Menjelaskan berapa pertemuan, output belajarnya seperti apa, keunggulan programnya, dan dikaitkan lagi dengan tujuan orang tua. (Silabus dan karya anak)\\n\\nExample:\\n\"Nah di program graphic design ini nanti (nama anak) akan belajar banyak hal yaa dari design 2 dimensi hingga 3 dimensi, selain itu juga (nama anak) bisa membuat project animasi, akan ada sekitar 5 aplikasi yang akan digunakan untuk (nama anak) belajar nantinya, sehingga kemampuan dan knowlage (nama anak) akan sangat meningkat yaa mama/papa, ditambah pembelajaran kita berbasis project yang sudah memiliki kurikulum sendiri, setiap modulnya ada project sebagai capaian belajar (nama anak\"\\n\\nNotes: Pastikan program sudah sesuai dengan harapan/rencana orang tua, ajak parent aktif menyampaikan tanggapannya mengenai program Algonova.\\nJelaskan bahwa program ini tidak bisa dilakukan hanya sekali dua kali, bangun urgensi dan jual mimpi ke orang tua. Tekankan bahwa untuk membuat animasi/game sendiri butuh proses. Disini libatkan juga kesiapan anak untuk belajar selama 36/32 pertemuan setiap programnya secara online. Pembelajaran ini tujuannya adalah untuk mengoptimalkan kemampuan anak dibidang coding/design/math yang mana menjadi bekal untuk anak kedepannya.\\n\\nExample:\\n\"Menurut Mama sudah sesuai belum program ini untuk (nama anak) belajar kedepannya? untuk kelas akan berlangsung secara online minimal satu minggu satu kali, dan untuk per kurikulumnya nanti ada sekitar 32/36 pembelajaran sesuai course, bagaimana dari (nama anak) sudah siap untuk belajar sampai bisa bikin project animasi kamu sendiri?\"\\n\\n",
                "extended_description": "The aim is to present the learning roadmap and build confidence in the program. The AI should identify phrases like 'learning path,' 'what you will learn,' 'course structure,' 'our curriculum,' and 'student projects.' A good example is, 'Let me show you the roadmap of what you'll learn in this course, from the basics to creating your own project.' Simply mentioning the course name is not sufficient."
            },
            {
                "id": "item_real_1__2__1__2__1__2_1__2_1__2_1__2_16",
                "type": "discuss",
                "content": "Real Point (Math)\\nIce Breaking Before Practical\\nNotes: TCM memberikan ice breaking before practical kepada anak untuk mencairkan suasana sebelum pembelajaran math dimulai, contoh mengajarkan hitung hitungan sederhana atau main tebak tebakan.",
                "extended_description": "The objective of this item is to use a math-related icebreaker to create a relaxed and engaging atmosphere before the practical session. The AI should look for keywords and phrases related to simple math puzzles, number games, or fun calculations, such as 'let's play a quick number game,' 'can you solve this riddle,' or 'let's warm up with a fun math question.' An example of a suitable statement would be, 'Before we start the main lesson, how about a quick brain teaser with numbers?' The AI should avoid flagging generic greetings or questions that are not related to math as completion of this item."
            },
            {
                "id": "item_practical__e_ion_17",
                "type": "discuss",
                "content": "Practical session\\nNotes:\\n- Sesi ini adalah salah satu cara untuk delivery value dari course, maka WAJIB DIKUASAI dari sisi teknis dan penyampaian practical yang baik dan menyenangkan.\\n- TCM wajib membantu anak jika anak kesulitan dalam memahami perintah atau penggunaan komputer.\\n- Diaharapkan pintar memuji anak, delivery value yang kaitkan dengan skill potensial anak, seperti problem solving, analisa yang kuat, logika yang tinggi, fokus, teliti, dan lain-lain.\\n- Libatkan anak dan orang tua dalam proses (feedback, tanya pendapat, apresiasi progress kecil).\\n\\nExample:\\n\"\u2018Wah keren banget (nama anak)! penggunaan mousenya sudah lancar yaa, (nama anak) sudah bisa menyusul balok di tinkercad dan bisa membuat karakternya sendiri nih mam, padahal ini baru pertama kali (nama anak) coba tinkercad ya? Tapi sudah kelihatan luwes banget, bener gak nih mam?",
                "extended_description": "The goal is to conduct an engaging and interactive practical session. The AI should detect keywords like 'let's try this,' 'your turn,' 'great job,' 'what do you think,' and 'how does that work.' An example is, 'Now, try to solve this problem on your own. I'm here to help if you get stuck.' This is not complete if the tutor just lectures without any interaction."
            },
            {
                "id": "item_after_1__2_n_1__2_ha_il_praktik_dari_anak_18",
                "type": "say",
                "content": "After Practical\\n\\nPresentasi hasil praktik dari anak\\nNotes:\\n- Setelah praktik, beri peran anak menjelaskan ke orang tua untuk membangun kedekatan emosional.\\n\\nExample:\\n- \"Wah hasilnya keren banget! Coba kamu jelasin sendiri ke Mama/papa, apa yang hari ini kamu buat, dan gimana serunya kamu belajar bikin animasi menggunakan Wick Editor?\"\\n\\n- \"Yesss, keren banget yaa (nama anak) sudah bisa mengerjakan beberapa soal dengan baik hari ini, coba kamu bisa ceritakan ke mama/papa apa yang kamu kerjakan hari ini, dan bagaimana nih belajar Math di Algonova?\"",
                "extended_description": "The objective is to have the child present their work to their parent, fostering a sense of accomplishment. The AI should look for phrases like 'show your parent what you did,' 'explain your project,' and 'tell us what you learned.' A good example is, 'Can you explain to your mom and dad what you've created today?' Simply saying 'good job' is not enough."
            },
            {
                "id": "item_feedback_orang_tua_19",
                "type": "discuss",
                "content": "Feedback orang tua\\nNotes: Setelah TCM menjelaskan hasil praktik ke anak, beri waktu dan peran ortu menilai praktik anak.\\n\\nExample:\\n- \"Keren, tepuk tangan dulu! Mama/papa boleh kasih pendapat sedikit, kira-kira apa yang sudah bagus dan apa yang bisa lebih ditingkatkan lagi nih dari project yang sudah dibuat?\"\\n- \"Menurut mama/papa bagaimana pembelajaran (nama anak) hari ini? bagian mana yang sudah bagus dan yang perlu ditingkatkan lagi nih mam?\"",
                "extended_description": "The aim is to get feedback from the parent on the child's performance and the trial class experience. The AI should identify questions like 'what did you think,' 'how did they do,' 'any feedback for us,' and 'your thoughts.' An example is, 'What are your thoughts on how your child engaged with the lesson today?' This is not complete if the tutor only asks the child for feedback."
            },
            {
                "id": "item_after_1__2_n_1__2_ha_il_praktik_dengan_kebutuhan_dunia_nyata_20",
                "type": "discuss",
                "content": "After Practical\\n\\nMenghubungkan hasil praktik dengan kebutuhan dunia nyata\\nNotes: Hubungkan hasil praktik anak dengan dunia nyata, minat pribadi anak, dan kebutuhan saat profiling, tunjukkan pencapaiannya dan bangun rasa bangga.\\n\\nExample:\\n\"Keren sekali yaa mama/papa, dalam pembelajaran praktik selama kurang lebih 15 menit, (nama anak) sudah bisa membuat karyanya sendiri. Graphic design ini (nama anak) tidak hanya belajar membuat karya saja yaa mam, namun lebih kompleks lagi (nama anak) akan mempelajari banyak konsep graphic design, konsisten mengembangkan bakat dan potensinya melalui pembelajaran berkelanjutan, kreatifitasnya terus terasah, ketelitian dan kesabarannya meningkat, secara teknis penggunaan komputer dan plathform graphic design juga akan lebih mahir. Dari karya yang (nama anak) buat juga bisa loh mam menjadi portolio anak, diikutkan kompetisi, atau kalo sekolahnya (nama anak) sedang ada acara, (nama anak) bisa ikut berpartisipasi juga karena pinter design.\"\\n\\n\"Pinter banget yaa mam tadi (nama anak) untuk mengerjakan soal soalnya. Pembelajaran Math di Algonova yang (nama anak) sudah kerjakan tadi, memiliki metode pemahaman konsep ya mam, sehingga tadi (nama anak) belajarnya nyaman dan cepat paham, dan miss jamin jika (nama anak) bisa konsisten belajar di kelas lanjutan maka goals mama/papa tadi agar nilai sekolah meningkat, ikut kompetisi juga bisa terwujud, selain itu juga (nama anak) bisa lebih mahir lagi dalam penggunaan komputer.\"",
                "extended_description": "The goal is to connect the skills learned in the practical session to real-world applications and the child's interests. The AI should detect phrases like 'this is how you can use this,' 'in the real world,' 'useful for,' and 'build on this skill.' A good example is, 'The skills you learned today are the first step to creating your own video games.' Simply praising the child's work is not enough."
            }
        ]
    },
    {
        "id": "stage_pre_enta_i",
        "name": "Presentasi",
        "startOffsetSeconds": 1800,
        "durationSeconds": 420,
        "items": [
            {
                "id": "item_memperkenalkan_1__2__ebagai_1__2__chool_21",
                "type": "say",
                "content": "Memperkenalkan Algonova sebagai International school\\nNotes:\\n- TCM wajib secara optimal menggunakan landing page untuk memperkenalkan Algonova setelah sesi praktik, memperkenalkan Algonova yang sudah tersebar di berbagai negara sebagai sekolah IT dan Math International.\\n\\n\\n\"... Perkenalkan ini Algonova, kami adalah sekolah IT dan Math bertaraf Internasional, saat ini Algonova sudah tersebar di berbagai negara di Dunia dengan jumlah siswa lebih dari xxx...\"",
                "extended_description": "The objective is to position Algonova as a global and reputable international school. The AI should look for keywords like 'international school,' 'in many countries,' 'global community,' and 'our students worldwide.' An example statement is, 'We are an international school with students from over 100 countries.' Mentioning the school's name without the international context is not sufficient."
            },
            {
                "id": "item_menjela_kan_pre_ta_i__i_wa_1__2_dan_te_timoni_orang_tua_22",
                "type": "say",
                "content": "Menjelaskan prestasi siswa Algonova dan testimoni orang tua\\nNotes:\\n- TCM wajib menjelaskan prestasi siswa dan testimoni orang tua untuk memberikan gambaran kedepan jika anak tidak hanya belajar namun memiliki potensi untuk lebih berprestasi. Hal ini juga akan meningkatkan kepercayaan orang tua untuk mendaftarkan anak di kelas lanjutan dan saat sesi negosiasi bisa diingatkan kembali jika pembayaran sudah include pengembangan potensi anak untuk mengikuti kompetisi.\\n\\n- Minta feedback dari orang tua dan anak terkait penjelasan prestasi dan testimoni.",
                "extended_description": "The aim is to build trust and credibility by showcasing student achievements and parent testimonials. The AI should detect phrases like 'our students have achieved,' 'parent testimonials,' 'success stories,' and 'what other parents say.' An example is, 'Let me share a story of one of our students who won a national coding competition.' This is not complete if the tutor only talks about the curriculum."
            },
            {
                "id": "item_memperkenalkan_cour_e_lain_dan_jalur_pendidikan_23",
                "type": "say",
                "content": "Memperkenalkan course lain dan jalur pendidikan\\nNotes:\\n- TCM wajib menjelaskan terkait jalur pendidikan di sesi presentasi untuk memberikan gambaran kepada orang tua jika anak tidak hanya belajar satu level saja, hal ini juga berpeluang untuk meningkatkan payment.\\n- TCM wajib memperkenalkan kelas lain yang sesuai dengan usia anak sebagai awal penawaran kelas bundling.\\n- Berikan informasi jumlah pelajaran dari tiap course yang dijelaskan sebagai bagian dari jalur pendidikan si anak sehingga bisa lebih mudah merekomendasikan paket belajarnya.\\n- Minta feedback dari klien.",
                "extended_description": "The goal is to introduce other relevant courses and the long-term learning path at Algonova. The AI should identify keywords like 'other courses,' 'learning journey,' 'next level,' 'continue learning,' and 'bundling options.' A good example is, 'After you master this course, you can move on to our advanced program in game development.' Only talking about the current course is not enough."
            },
            {
                "id": "item_komunika_i_dua_arah_24",
                "type": "discuss",
                "content": "Komunikasi dua arah\\nNotes:\\n- TCM melalukan sesi presentasi dua arah, tidak hanya dengan orang tua naum juga melibatkan anak, bisa mengoptimalkan landing page sebagai bahan interaksi seperti contoh karya dan review dari orang tua.",
                "extended_description": "The objective is to maintain a two-way conversation with both the parent and the child throughout the presentation. The AI should look for questions like 'what do you think,' 'does that make sense,' 'any questions so far,' and 'what are your thoughts on this.' An example is, 'What are your thoughts on this part of the curriculum?' This is not complete if the tutor talks for a long time without asking for input."
            },
            {
                "id": "item_refre_hment_25",
                "type": "discuss",
                "content": "Refreshment\\nNotes:\\n- TCM wajib memberikan kesimpulan berjalannya trial class sebelum sesi negosiasi, meliputi kebutuhan klien di sesi profiling, feedback saat praktik dan kecocokan orang tua dan anak dengan program serta kurikulum dan kesiapan menuju kelas lanjutan.\\n\\nExample:\\n\\n\"Sebelum Miss tunjukan investasi pendidikan kedepan, Miss izin untuk mengingatkan kembali yaa mama/papa apa saja yang sudah kita lewati selama sesi trial class. Jadi mama/papa mendaftarkan (nama anak) karena ..................... dengan tujuan agar ..............., tadi (nama anak) sudah praktik dan hasilnya luar biasa ya, (nama anak) suka, mampu mengikuti dengan baik, terkait dengan sekolah Algonova dan kurikulum pembelajarannya sudah sesuai juga ya. Nah saat ini waktu yang tepat untuk (nama anak) bisa mengembangkan potensinya di bidang IT/ meningkatka kemampuan Math melalui kelas lanjutan Algonova.\"",
                "extended_description": "The aim is to summarize the key points of the trial class before moving to the negotiation stage. The AI should detect phrases like 'to recap,' 'let's summarize,' 'as we discussed,' and 'we've covered.' A good example is, 'So, to summarize, we've seen how [Child's Name] enjoys learning to code and how our program can help them achieve their goals.' This is not complete if the tutor moves to pricing without a summary."
            }
        ]
    },
    {
        "id": "stage_nego_ia_i",
        "name": "Negosiasi",
        "startOffsetSeconds": 2220,
        "durationSeconds": 480,
        "items": [
            {
                "id": "item_menjela_kan_dan_merekomenda_ikan_jeni__kela___1__2__1__2__dan_1__2_26",
                "type": "say",
                "content": "Menjelaskan dan merekomendasikan jenis kelas (Private, Premium, dan Group)\\nNotes:\\n- TCM menjelaskan format kelas yang ada di Algonova dan merekomendasikan jenis kelas yang sesuai dengan kondisi anak, diutamakan merekomendasikan kelas private agar penjualan paket besar dan private meningkat.",
                "extended_description": "The objective is to explain the different class formats and recommend the most suitable one for the child. The AI should identify keywords like 'class types,' 'private lessons,' 'group classes,' 'premium,' and 'we recommend.' An example is, 'We offer both private and group classes. Based on your child's needs, I would recommend the private option.' Simply stating the price is not enough."
            },
            {
                "id": "item_rekomenda_i_paket__e_uai_kebutuhan_27",
                "type": "discuss",
                "content": "Rekomendasi paket sesuai kebutuhan\\nNotes:\\n- Setelah menemukan kecenderungan paket yang akan diambil oleh klien (private/group/premium), maka selanjutnya menjelaskan masing-masing paket belajar 40,80, dan 120, beserta benefitnya yang kemudian merekomendasikan paket yang cocok untuk anak.\\nExample:\\n- Baik Mama/papa, sesuai dengan goals mama/papa dan hasil praktik dari (nama anak) yang sangat baik di Trial Class ini maka saya merekomendasikan yang 80 pelajaran. Kenapa? (Berikan alasan kenapa merekomendasikan paket tersebut misalnya tadi anak sangat bagus saat praktikalnya, dan artinya adik sudah memiliki dasar yang sangat baik dalam bidang Coding/Desing, Math, yang tentu akan sangat mendukung juga mencapai masa depan dan cita-cita adek yang tadi, bisa disebutkan kembali goals anak. Atau alasan lain yang kita temukan saat trial class berlangsung).",
                "extended_description": "The goal is to recommend a specific course package based on the client's needs and goals. The AI should detect phrases like 'recommend this package,' 'the best option for you,' 'based on your goals,' and 'this package includes.' A good example is, 'I recommend the 80-lesson package because it will give your child enough time to master the fundamentals.' Only mentioning the number of lessons is not sufficient."
            },
            {
                "id": "item_clarify_client___objection_with_1__2_28",
                "type": "discuss",
                "content": "Clarify client's objection with Formula\\n\\nNotes: Pada saat client mengajukan objection, pastikan untuk menggali lebih dalam real concern dari klien secara lebih spesifik\\nContoh teknis & alur penjelasannya sesuai rumus (Acknowledge - Clarify (Identify the Real Concern ) - Respond with Value - Close the Deal) silahkan lihat di sheet Handle Objection.\\nNew Script - Upgrade",
                "extended_description": "The objective is to understand and address any objections the client may have. The AI should identify phrases like 'I understand your concern,' 'can you tell me more about that,' 'what is your main hesitation,' and 'let me clarify.' An example is, 'I understand your concern about the price. Can you tell me more about what you were expecting?' This is not complete if the tutor just repeats the price."
            },
            {
                "id": "item_handling_objection_klien_29",
                "type": "say",
                "content": "Handling objection klien\\nContoh teknis & alur penjelasannya sesuai rumus (Acknowledge - Clarify - Respond with Value - Close the Deal) silahkan lihat di sheet Handle Objection\\nNotes:\\n> Respon with value (Berikan Benefit (manfaat) & Tools (Solusi) secara bertahap\\n>> Benefit (manfaat) adalah fasilitas / keunggulan yang dimiliki oleh Algo misalnya platform bisa di akses 24/7, sertifikat internasional, bisa pilih jadwal yang cocok dengan klien sesuai jadwal yang tersedia, bisa terlewat kelas bisa meminta recording atau mengikuti extra class, bisa membekukan paket (cuti), dll\\n>> Tools (Solusi): Fasilitas pembayaran dengan BNPL & Kartu Kredit, Special Discount, Refund\\n\\nPastikan benefit ter-delivery terlebih dahulu ke klien sebelum tools dikonfirmasi, bukan sebaliknya!",
                "extended_description": "The aim is to effectively handle client objections by providing value and solutions. The AI should detect keywords like 'flexible payment,' 'installment plan,' 'trial period,' 'satisfaction guarantee,' and 'special discount.' A good example is, 'We offer flexible payment plans to make it more affordable for you.' Simply saying 'I understand' is not enough."
            },
            {
                "id": "item_clear_information_terkait_refund__kela___jadwal__harga__dll_30",
                "type": "discuss",
                "content": "Clear information terkait refund, kelas, jadwal, harga, dll\\nLihat clear information ini di sheet Penjelasan Refund, Extra Class\\nNew Script - Upgrade",
                "extended_description": "The goal is to provide clear and transparent information about refunds, scheduling, pricing, and other terms. The AI should look for phrases like 'refund policy,' 'scheduling flexibility,' 'no hidden fees,' and 'terms and conditions.' An example is, 'We have a clear refund policy, which I can explain to you now.' This is not complete if the tutor is vague or avoids answering these questions."
            },
            {
                "id": "item_menawarkan_1__2___1__2__bnpl_31",
                "type": "discuss",
                "content": "Menawarkan Referral / Bundling, BNPL\\nNotes:\\n- Referal bisa disampaikan di stage TC manapun, dengan catatan menyampaikan banefit kelas.\\n\\nExample:\\n\"Adik bisa didaftarkan juga mam, nanti kakak dapat banefit free class 4x untuk kelas lanjutannya, dan setiap mengajak 1 teman lain dan temannya berhasil daftar juga nanti akan dapat bonus berlaku kelipatan\"\\n\\nNotes:\\n- Bundling hanya akan di hitung jika penyampaian dilakukan start presentasi hingga akhir dengan menyampaikan banefit bundling yaitu kelas bersamaan dan extra discount 10%.\\n\\nExample:\\n- Untuk saat ini (nama anak) usia 10 tahun jadi bisa sekali jika mau ikut kelas di course lain, Math dan Design, nanti kelasnya bisa berjalan bersamaan dan dapat extra potongan biaya di second course.\\n\\nNote:\\n- BNPL di tawarkan sebagai metode pembayaran, handling budget issue, dan tidak boleh menawarkan 10 lessons.\\n\\nPanduan\\nNew Script - Upgrade",
                "extended_description": "The objective is to offer referral programs, bundling options, or BNPL (Buy Now, Pay Later) as additional incentives. The AI should identify keywords like 'refer a friend,' 'bundle and save,' 'installment plan,' and 'pay later.' A good example is, 'If you refer a friend, you both get a discount on your next package.' This is not complete if the tutor only mentions the total price."
            },
            {
                "id": "item_mengakhiri_zoom_dengan_profe_ional_32",
                "type": "say",
                "content": "Mengakhiri zoom dengan profesional\\nExample:\\nPaid \u2192 ucapkan selamat bergabung di Algonova dan terima kasih kepada orang tua karena sudah support anak untuk belajar di Algonova, sampaikan informasi tambahan yang wajib disampaikan (contoh: referral), reminder anak agar tetap semangat belajar di kelas lanjutan seperti saat trial class, pastikan informasi mengenai pembelajaran dan ketentuan sudah clear (meminimalisir komplain)\\n\\nNot Paid \u2192 tetap berikan kesan professional. Berikan kesan trial class di Algonova \u2018worth to try\u2019 walaupun diberikan secara gratis. Tekankan bahwa Algonova sangat terbuka sekali jika suatu hari nanti klien ingin mendaftar untuk kelas lanjutannya kembali (ini akan memudahkan TCM untuk follow up jika klien tidak bisa paid ots)",
                "extended_description": "The aim is to end the Zoom call professionally, regardless of the outcome. The AI should detect phrases like 'thank you for your time,' 'it was a pleasure,' 'we hope to see you again,' and 'congratulations on enrolling.' A good example for a non-paying client is, 'Thank you for your time today. We hope you enjoyed the trial class and we'd be happy to welcome you in the future.' A simple 'goodbye' is not sufficient."
            }
        ]
    }
]

def get_default_call_structure() -> List[CallStage]:
    """Get the default call structure configuration"""
    return DEFAULT_CALL_STRUCTURE


def get_stage_by_time(elapsed_seconds: int) -> str:
    """
    Determine current stage based on elapsed time (FALLBACK ONLY)
    
    NOTE: This is now a fallback. Use detect_stage_by_context() for AI-based detection.
    
    Args:
        elapsed_seconds: Seconds since call start
        
    Returns:
        Stage ID that should be active at this time
    """
    structure = get_default_call_structure()
    
    for stage in reversed(structure):  # Check from end to start
        if elapsed_seconds >= stage['startOffsetSeconds']:
            return stage['id']
    
    return structure[0]['id'] if structure else ""


def detect_stage_by_context(
    conversation_text: str,
    elapsed_seconds: int,
    analyzer,  # TrialClassAnalyzer instance
    previous_stage_id: str = None,
    min_confidence: float = 0.6
) -> str:
    """
    Detect current stage using AI analysis of conversation context
    
    Args:
        conversation_text: Recent conversation transcript
        elapsed_seconds: Current call time (for context only)
        analyzer: TrialClassAnalyzer instance with detect_current_stage method
        previous_stage_id: Last detected stage (to prevent jitter)
        min_confidence: Minimum confidence to accept stage change
        
    Returns:
        Stage ID that matches the current conversation context
    """
    structure = get_default_call_structure()
    if not structure:
        return ""
    
    # Guard: Skip if conversation too short
    if len(conversation_text.strip()) < 100:
        # At start, use first stage
        return structure[0]['id']
    
    try:
        # Use AI to detect stage
        detected_stage_id, confidence = analyzer.detect_current_stage(
            conversation_text=conversation_text,
            stages=structure,
            call_elapsed_seconds=elapsed_seconds
        )
        
        # If confident, use AI detection
        if confidence >= min_confidence:
            return detected_stage_id
        
        # Low confidence - check if should keep previous stage
        if previous_stage_id and confidence < min_confidence:
            # Don't change stage on low confidence
            return previous_stage_id
        
        # Fallback to time-based
        print(f"   âš ï¸ Low confidence ({confidence:.0%}), using time-based fallback")
        return get_stage_by_time(elapsed_seconds)
        
    except Exception as e:
        print(f"   âš ï¸ Stage detection error: {e}, using time-based fallback")
        return get_stage_by_time(elapsed_seconds)


def get_stage_timing_status(stage_id: str, elapsed_seconds: int) -> Dict[str, Any]:
    """
    Check if a stage is on time, late, or not started
    
    Args:
        stage_id: The stage to check
        elapsed_seconds: Current call time
        
    Returns:
        Dict with status: 'not_started' | 'on_time' | 'slightly_late' | 'very_late'
    """
    structure = get_default_call_structure()
    stage = next((s for s in structure if s['id'] == stage_id), None)
    
    if not stage:
        return {'status': 'unknown', 'message': 'Stage not found'}
    
    stage_start = stage['startOffsetSeconds']
    stage_end = stage_start + stage['durationSeconds']
    
    if elapsed_seconds < stage_start:
        return {
            'status': 'not_started',
            'message': f"Starts in {(stage_start - elapsed_seconds) // 60} min"
        }
    elif elapsed_seconds <= stage_end:
        return {
            'status': 'on_time',
            'message': 'On track'
        }
    elif elapsed_seconds <= stage_end + 120:  # 2 min grace period
        return {
            'status': 'slightly_late',
            'message': 'Slightly behind'
        }
    else:
        minutes_late = (elapsed_seconds - stage_end) // 60
        return {
            'status': 'very_late',
            'message': f"{minutes_late} min behind"
        }


def validate_call_structure(structure: List[Dict]) -> bool:
    """
    Validate a call structure configuration
    
    Args:
        structure: List of stage dictionaries
        
    Returns:
        True if valid, raises ValueError if invalid
    """
    required_stage_fields = ['id', 'name', 'startOffsetSeconds', 'durationSeconds', 'items']
    required_item_fields = ['id', 'type', 'content', 'extended_description']
    
    if not isinstance(structure, list):
        raise ValueError("Structure must be a list or empty.")
    
    if not structure:
        return True # An empty structure is valid

    stage_ids = set()
    item_ids = set()
    
    for stage in structure:
        # Check required fields
        for field in required_stage_fields:
            if field not in stage:
                raise ValueError(f"Stage missing required field: {field}")
        
        # Check unique stage ID
        if stage['id'] in stage_ids:
            raise ValueError(f"Duplicate stage ID: {stage['id']}")
        stage_ids.add(stage['id'])
        
        # Validate items
        if not isinstance(stage['items'], list):
            raise ValueError(f"Stage {stage['id']} items must be a list")
        
        for item in stage['items']:
            for field in required_item_fields:
                if field not in item:
                    raise ValueError(f"Item missing required field: {field}")
            
            # Check unique item ID (globally)
            if item['id'] in item_ids:
                raise ValueError(f"Duplicate item ID: {item['id']}")
            item_ids.add(item['id'])
            
            # Validate item type
            if item['type'] not in ['discuss', 'say']:
                raise ValueError(f"Item type must be 'discuss' or 'say', got: {item['type']}")
    
    return True
